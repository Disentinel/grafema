{
  "name": "grafema-explore",
  "displayName": "Grafema Explore",
  "description": "Interactive graph navigation for Grafema code analysis",
  "version": "0.2.0",
  "publisher": "grafema",
  "engines": {
    "vscode": "^1.74.0"
  },
  "categories": [
    "Other"
  ],
  "activationEvents": [
    "onView:grafemaStatus",
    "onView:grafemaExplore",
    "onView:grafemaValueTrace",
    "onView:grafemaCallers"
  ],
  "main": "./dist/extension.js",
  "contributes": {
    "viewsContainers": {
      "activitybar": [
        {
          "id": "grafema",
          "title": "Grafema",
          "icon": "resources/grafema-icon.svg"
        }
      ]
    },
    "views": {
      "grafema": [
        { "id": "grafemaStatus", "name": "Status", "visibility": "visible" },
        { "id": "grafemaValueTrace", "name": "Value Trace", "visibility": "collapsed" },
        { "id": "grafemaCallers", "name": "Callers", "visibility": "collapsed" },
        { "id": "grafemaBlastRadius", "name": "Blast Radius", "visibility": "collapsed" },
        { "id": "grafemaIssues", "name": "Issues", "visibility": "collapsed" },
        { "id": "grafemaExplore", "name": "Explorer", "visibility": "collapsed" },
        { "id": "grafemaDebug", "name": "Debug Log", "visibility": "collapsed" }
      ]
    },
    "viewsWelcome": [
      {
        "view": "grafemaBlastRadius",
        "contents": "Blast radius shows what breaks if you change this code.\n\nComing in Phase 4."
      },
      {
        "view": "grafemaIssues",
        "contents": "Issues panel shows guarantee violations and connectivity gaps.\n\nComing in Phase 3."
      }
    ],
    "commands": [
      {
        "command": "grafema.focusStatus",
        "title": "Grafema: Show Status"
      },
      {
        "command": "grafema.clearDebugLog",
        "title": "Clear Log",
        "icon": "$(clear-all)"
      },
      {
        "command": "grafema.gotoLocation",
        "title": "Go to Location"
      },
      {
        "command": "grafema.searchNodes",
        "title": "Grafema: Search Nodes",
        "icon": "$(search)"
      },
      {
        "command": "grafema.findAtCursor",
        "title": "Grafema: Find Node at Cursor",
        "icon": "$(inspect)"
      },
      {
        "command": "grafema.toggleFollowCursor",
        "title": "Grafema: Toggle Follow Cursor",
        "icon": "$(lock)"
      },
      {
        "command": "grafema.goBack",
        "title": "Grafema: Go Back",
        "icon": "$(arrow-left)"
      },
      {
        "command": "grafema.setAsRoot",
        "title": "Set as Root",
        "icon": "$(home)"
      },
      {
        "command": "grafema.refreshEdges",
        "title": "Refresh",
        "icon": "$(refresh)"
      },
      {
        "command": "grafema.copyTreeState",
        "title": "Grafema: Copy Tree State",
        "icon": "$(clippy)"
      },
      {
        "command": "grafema.filterTree",
        "title": "Grafema: Filter Tree",
        "icon": "$(filter)"
      },
      {
        "command": "grafema.openValueTrace",
        "title": "Grafema: Open Value Trace"
      },
      {
        "command": "grafema.toggleValueTraceDirection",
        "title": "Toggle Direction",
        "icon": "$(arrow-swap)"
      },
      {
        "command": "grafema.refreshValueTrace",
        "title": "Refresh",
        "icon": "$(refresh)"
      },
      {
        "command": "grafema.openCallers",
        "title": "Grafema: Open Callers"
      },
      {
        "command": "grafema.setCallersDepth",
        "title": "Set Max Depth",
        "icon": "$(layers)"
      },
      {
        "command": "grafema.toggleCallersFilter",
        "title": "Toggle Filters",
        "icon": "$(filter)"
      },
      {
        "command": "grafema.toggleCallersDirection",
        "title": "Toggle Direction",
        "icon": "$(arrow-swap)"
      },
      {
        "command": "grafema.refreshCallers",
        "title": "Refresh",
        "icon": "$(refresh)"
      },
      {
        "command": "grafema.blastRadiusPlaceholder",
        "title": "Blast Radius (coming Phase 4)"
      }
    ],
    "menus": {
      "view/title": [
        {
          "command": "grafema.searchNodes",
          "when": "view == grafemaExplore",
          "group": "navigation@0"
        },
        {
          "command": "grafema.goBack",
          "when": "view == grafemaExplore",
          "group": "navigation@1"
        },
        {
          "command": "grafema.toggleFollowCursor",
          "when": "view == grafemaExplore",
          "group": "navigation@2"
        },
        {
          "command": "grafema.findAtCursor",
          "when": "view == grafemaExplore",
          "group": "navigation@3"
        },
        {
          "command": "grafema.refreshEdges",
          "when": "view == grafemaExplore",
          "group": "navigation@4"
        },
        {
          "command": "grafema.filterTree",
          "when": "view == grafemaExplore",
          "group": "navigation@5"
        },
        {
          "command": "grafema.copyTreeState",
          "when": "view == grafemaExplore",
          "group": "navigation@6"
        },
        {
          "command": "grafema.clearDebugLog",
          "when": "view == grafemaDebug",
          "group": "navigation@1"
        },
        {
          "command": "grafema.toggleValueTraceDirection",
          "when": "view == grafemaValueTrace",
          "group": "navigation@0"
        },
        {
          "command": "grafema.refreshValueTrace",
          "when": "view == grafemaValueTrace",
          "group": "navigation@1"
        },
        {
          "command": "grafema.toggleCallersDirection",
          "when": "view == grafemaCallers",
          "group": "navigation@0"
        },
        {
          "command": "grafema.toggleCallersFilter",
          "when": "view == grafemaCallers",
          "group": "navigation@1"
        },
        {
          "command": "grafema.setCallersDepth",
          "when": "view == grafemaCallers",
          "group": "navigation@2"
        },
        {
          "command": "grafema.refreshCallers",
          "when": "view == grafemaCallers",
          "group": "navigation@3"
        }
      ],
      "view/item/context": [
        {
          "command": "grafema.setAsRoot",
          "when": "view == grafemaExplore && viewItem == grafemaNode",
          "group": "navigation@1"
        },
        {
          "command": "grafema.setAsRoot",
          "when": "view == grafemaExplore && viewItem == grafemaEdge",
          "group": "navigation@1"
        }
      ],
      "view/item/inline": [
        {
          "command": "grafema.setAsRoot",
          "when": "view == grafemaExplore && viewItem == grafemaNode",
          "group": "inline"
        },
        {
          "command": "grafema.setAsRoot",
          "when": "view == grafemaExplore && viewItem == grafemaEdge",
          "group": "inline"
        }
      ]
    },
    "keybindings": [
      {
        "command": "grafema.toggleFollowCursor",
        "key": "ctrl+shift+g",
        "mac": "cmd+shift+g",
        "when": "editorTextFocus"
      },
      {
        "command": "grafema.copyTreeState",
        "key": "ctrl+shift+c",
        "mac": "cmd+shift+c",
        "when": "focusedView == grafemaExplore"
      }
    ],
    "configuration": {
      "title": "Grafema",
      "properties": {
        "grafema.rfdbServerPath": {
          "type": "string",
          "default": "",
          "description": "Path to rfdb-server binary. If empty, auto-detect."
        },
        "grafema.rfdbSocketPath": {
          "type": "string",
          "default": "",
          "description": "Path to RFDB unix socket. If empty, uses {workspace}/.grafema/rfdb.sock"
        },
        "grafema.codeLens.enabled": {
          "type": "boolean",
          "default": true,
          "description": "Show Grafema CodeLens above functions (caller/callee counts)."
        },
        "grafema.codeLens.showBlastRadius": {
          "type": "boolean",
          "default": false,
          "description": "Show blast radius count in CodeLens. Requires Phase 4 (Blast Radius panel)."
        },
        "grafema.callers.defaultDepth": {
          "type": "number",
          "default": 3,
          "minimum": 1,
          "maximum": 5,
          "description": "Default max depth for call hierarchy expansion in CALLERS panel."
        },
        "grafema.callers.hideTestFiles": {
          "type": "boolean",
          "default": true,
          "description": "Hide test files from CALLERS panel (matches /test/, /tests/, .test., .spec., __tests__, cypress/, e2e/)."
        },
        "grafema.callers.hideNodeModules": {
          "type": "boolean",
          "default": true,
          "description": "Hide node_modules from CALLERS panel."
        }
      }
    }
  },
  "scripts": {
    "build": "node esbuild.config.mjs",
    "watch": "node esbuild.config.mjs --watch",
    "clean": "rm -rf dist binaries",
    "vscode:prepublish": "npm run build",
    "package": "vsce package",
    "package:darwin-arm64": "vsce package --target darwin-arm64",
    "package:darwin-x64": "vsce package --target darwin-x64",
    "package:linux-x64": "vsce package --target linux-x64",
    "package:linux-arm64": "vsce package --target linux-arm64",
    "package:universal": "vsce package"
  },
  "dependencies": {
    "@grafema/rfdb-client": "workspace:*",
    "@grafema/types": "workspace:*"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/vscode": "^1.74.0",
    "esbuild": "^0.19.0",
    "typescript": "^5.9.3"
  }
}
