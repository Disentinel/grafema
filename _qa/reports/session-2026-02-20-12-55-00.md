# QA Session Report

**Date:** 2026-02-20T12:55:00Z
**Status:** Blocked (infrastructure gap found)
**Mode:** Demo session — first run of `/qa` agent infrastructure

## Summary

- Files targeted: 1 (Orchestrator.ts)
- Lines checked: 0 (blocked before line-by-line check could start)
- Entities checked: 3 (class declaration, import, method — all returned placeholder data)
- Entities OK: 0
- Bugs found: 0
- Gaps found: 1 (GAP-001: No database selected)
- Pass rate: N/A

## Infrastructure Validated

The following Playwright automation capabilities were successfully tested:

| Capability | Status | Notes |
|-----------|--------|-------|
| Trust dialog dismissal | Working | Requires `page.evaluate()` with JS click on `monaco-dialog-box` |
| File opening via Quick Open | Working | `Meta+p` → type filename → Enter |
| Grafema sidebar activation | Working | `a[class*="view-extension-grafema"]` selector |
| Panel expansion | Working | Click `[aria-label="X Section"]` headers |
| Go to line | Working | `Control+g` (not `Meta+g`) |
| Entity click | Working | `page.mouse.click()` with charWidth=7.7, lineHeight=19 |
| Panel content reading | Working | `pane.evaluate()` to read `.pane-body` text |
| Screenshot capture | Working | Standard `page.screenshot()` |
| Hover tooltip | Not tested | Blocked by GAP-001 |

## Discovered Panel Names

The agent doc assumed 6 panels. Actual extension has 7 panels with different names:

| Agent Doc | Actual Panel | Match |
|-----------|-------------|-------|
| Hover Tooltip | (built-in Monaco hover) | N/A |
| Value Trace | Value Trace | exact |
| Callers | Callers | exact |
| Edges Explorer | **Blast Radius** | MISMATCH |
| Issues | Issues | exact |
| Status | Status | exact |
| (not documented) | **Explorer** | NEW |
| (not documented) | **Debug Log** | NEW |

**Action needed:** Update `.claude/agents/qa-agent.md` to use correct panel names.

## Gaps

### GAP-001: No Database Selected (BLOCKING)

Extension connects to rfdb-server but no graph database is opened. All queries fail with "No database selected. Use openDatabase first." No `Open Database` command exists in Command Palette.

**Full report:** `_qa/reports/gap-001.md`

## Playwright Findings

### Trust Dialog
The code-server trust dialog uses custom `monaco-dialog-box` component with a modal backdrop (`monaco-dialog-modal-block`). Standard `button:has-text()` selectors find buttons BEHIND the dialog (Getting Started page), not inside it. Must use `document.querySelector('.monaco-dialog-box')` then find clickable elements within.

### Keyboard Shortcut Hybrid
Code-server in Docker adapts keyboard shortcuts to the client OS. Since the Playwright browser reports macOS:
- `Meta+p` works for Quick Open
- `Meta+Shift+p` works for Command Palette
- `Meta+w` works for Close Tab
- But `Meta+g` does NOT work for Go to Line — must use `Control+g`

This inconsistency should be documented in the agent prompt.

### Activity Bar Icon
Grafema does NOT appear in the standard activity bar with `aria-label="Grafema"` on an `<a>` tag. Instead, it has a dynamically-generated class: `action-label activity-workbench-view-extension-grafema-{hash}`. The selector `a[class*="view-extension-grafema"]` reliably finds it.

## Screenshots

| # | File | Description |
|---|------|-------------|
| 01 | `01-grafema-commands.png` | Command Palette showing all Grafema commands |
| 02 | `02-open-database-cmd.png` | "Grafema: Open" search — no Open Database command |
| 03 | `03-entity-clicked.png` | Entity clicked with all panels expanded — placeholder text |
| 04 | `04-hover.png` | Hover attempt — no tooltip appears |
| 06 | `06-panels-after-db.png` | All 7 panels expanded |
| 07 | `07-entity-click-with-db.png` | Entity click result — still placeholder |

## Next Steps

1. **Fix GAP-001:** Add database auto-selection to extension OR add Open Database command OR configure demo Docker setup with correct settings
2. **Update agent doc:** Correct panel names (Blast Radius, not Edges Explorer), add Explorer and Debug Log panels
3. **Update agent selectors:** Use discovered Playwright selectors from this session
4. **Re-run `/qa`:** After GAP-001 is resolved, resume line-by-line checking from Orchestrator.ts line 1
