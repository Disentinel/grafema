# T4.4: Integration Gate Validation

> Milestone: M4 (Integration Gate) — THE GATE
> Dependencies: T4.1, T4.2, T4.3, T3.2, T3.3
> Estimated: ~15 tests + benchmark report
> Related docs: All previous specs

---

## High-Level Context

**Sync point S3.** Все треки сходятся. v2 engine должен полностью заменить v1.

T4.4 — это НЕ новая функциональность. Это **комплексная валидация** что всё работает вместе.

---

## Validation Checklist

### 1. Full Test Suite

- [ ] ALL Rust unit tests pass
- [ ] ALL TS unit tests pass
- [ ] ALL integration tests (TS client ↔ Rust server) pass
- [ ] Datalog tests pass on v2 engine
- [ ] Field declaration + secondary index tests pass

### 2. Benchmark Suite: v2 vs v1

| Metric | Measure | Compare to v1 |
|--------|---------|---------------|
| Point lookup latency | 10K lookups on 10K node graph | Must be <2x v1 |
| Attribute query (by type) | 10K nodes, query FUNCTION | Must be <2x v1 |
| Neighbor query | 10K edges, outgoing from random node | Must be <3x v1 |
| Write throughput | Batch add 10K nodes | Must be >50% of v1 |
| CommitBatch latency | 1 file commit on 10K node graph | Baseline (new) |
| Memory usage (RSS) | After loading 10K nodes | Must be <2x v1 |

### 3. Stress Test

- [ ] Synthetic graph: 100K nodes, 700K edges
- [ ] Write → flush → query → verify correctness
- [ ] Memory stays bounded (no leaks)
- [ ] All query types return correct results

### 4. Crash Recovery

- [ ] Kill server mid-batch → restart → previous snapshot intact
- [ ] Kill server mid-flush → restart → no corruption
- [ ] Orphan segments cleaned up on next GC

### 5. Concurrent Clients

- [ ] Two TS clients → same server → independent databases → no interference
- [ ] Two TS clients → same database → independent batches → correct isolation
- [ ] One client writes, one reads → reader sees consistent snapshot

---

## Deliverables

1. **Test report:** All test results documented
2. **Benchmark report:** v2 vs v1 comparison table
3. **Known limitations:** Documented gaps (if any) with Linear issues
4. **Performance baseline:** Numbers recorded for future comparison (T6.3)
